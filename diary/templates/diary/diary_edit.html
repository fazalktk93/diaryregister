{% extends "base.html" %}
{% block title %}Edit Diary {{ diary.diary_no }}{% endblock %}

{% block content %}
<div class="page-header mb-4">
  <div class="d-flex justify-content-between align-items-center">
    <div>
      <h1 class="mb-1"><i class="bi bi-pencil"></i> Edit Diary</h1>
      <p class="text-light mb-0 opacity-75">Diary: <strong>{{ diary.diary_no }}</strong></p>
    </div>
    <a href="{% url 'diary_detail' diary.pk %}" class="btn btn-light btn-sm">
      <i class="bi bi-arrow-left"></i> Back
    </a>
  </div>
</div>

<div class="row justify-content-center">
  <div class="col-lg-8">
    <div class="card">
      <div class="card-body">
        <form method="post" novalidate>
          {% csrf_token %}
          
          <div class="row g-3">
            <div class="col-md-6">
              <label for="{{ form.diary_date.id_for_label }}" class="form-label">{{ form.diary_date.label }}</label>
              {{ form.diary_date }}
              {% if form.diary_date.errors %}
                <div class="alert alert-danger mt-1 py-1 px-2 small mb-0">
                  <i class="bi bi-exclamation-circle"></i> {{ form.diary_date.errors|striptags }}
                </div>
              {% endif %}
            </div>

            <div class="col-md-6">
              <label for="{{ form.received_diary_no.id_for_label }}" class="form-label">{{ form.received_diary_no.label }}</label>
              {{ form.received_diary_no }}
              {% if form.received_diary_no.errors %}
                <div class="alert alert-danger mt-1 py-1 px-2 small mb-0">
                  <i class="bi bi-exclamation-circle"></i> {{ form.received_diary_no.errors|striptags }}
                </div>
              {% endif %}
            </div>

            <div class="col-md-6">
              <label for="{{ form.received_from.id_for_label }}" class="form-label">{{ form.received_from.label }}</label>
              {{ form.received_from }}
              {% if form.received_from.errors %}
                <div class="alert alert-danger mt-1 py-1 px-2 small mb-0">
                  <i class="bi bi-exclamation-circle"></i> {{ form.received_from.errors|striptags }}
                </div>
              {% endif %}
            </div>

            <div class="col-md-6">
              <label for="{{ form.marked_to.id_for_label }}" class="form-label">{{ form.marked_to.label }}</label>
              {{ form.marked_to }}
              {% if form.marked_to.errors %}
                <div class="alert alert-danger mt-1 py-1 px-2 small mb-0">
                  <i class="bi bi-exclamation-circle"></i> {{ form.marked_to.errors|striptags }}
                </div>
              {% endif %}
            </div>

            <div class="col-md-6">
              <label for="{{ form.file_letter.id_for_label }}" class="form-label">{{ form.file_letter.label }}</label>
              {{ form.file_letter }}
              {% if form.file_letter.errors %}
                <div class="alert alert-danger mt-1 py-1 px-2 small mb-0">
                  <i class="bi bi-exclamation-circle"></i> {{ form.file_letter.errors|striptags }}
                </div>
              {% endif %}
            </div>

            <div class="col-md-6">
              <label for="{{ form.no_of_folders.id_for_label }}" class="form-label">{{ form.no_of_folders.label }}</label>
              {{ form.no_of_folders }}
              {% if form.no_of_folders.errors %}
                <div class="alert alert-danger mt-1 py-1 px-2 small mb-0">
                  <i class="bi bi-exclamation-circle"></i> {{ form.no_of_folders.errors|striptags }}
                </div>
              {% endif %}
            </div>

            <div class="col-md-12">
              <label for="{{ form.subject.id_for_label }}" class="form-label">{{ form.subject.label }}</label>
              {{ form.subject }}
              {% if form.subject.errors %}
                <div class="alert alert-danger mt-1 py-1 px-2 small mb-0">
                  <i class="bi bi-exclamation-circle"></i> {{ form.subject.errors|striptags }}
                </div>
              {% endif %}
            </div>

            <div class="col-md-12">
              <label for="{{ form.remarks.id_for_label }}" class="form-label">{{ form.remarks.label }}</label>
              {{ form.remarks }}
              {% if form.remarks.errors %}
                <div class="alert alert-danger mt-1 py-1 px-2 small mb-0">
                  <i class="bi bi-exclamation-circle"></i> {{ form.remarks.errors|striptags }}
                </div>
              {% endif %}
            </div>
          </div>

          {% if form.non_field_errors %}
            <div class="alert alert-danger mt-3">
              <i class="bi bi-exclamation-triangle"></i> {{ form.non_field_errors }}
            </div>
          {% endif %}

          <div class="d-flex gap-2 mt-4">
            <button type="submit" class="btn btn-primary">
              <i class="bi bi-check-circle"></i> Save Changes
            </button>
            <a href="{% url 'diary_detail' diary.pk %}" class="btn btn-outline-secondary">
              <i class="bi bi-x-circle"></i> Cancel
            </a>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  // Enable "No. of folders" only when File is selected
  document.addEventListener("DOMContentLoaded", function () {
    const kind = document.getElementById("id_file_letter");
    const folders = document.getElementById("id_no_of_folders");

    function syncFoldersState() {
      if (!kind || !folders) return;
      const isFile = (kind.value || "").toLowerCase() === "file";
      folders.disabled = !isFile;

      const wrap = folders.closest(".col-md-6") || folders.closest(".mb-3");
      if (wrap) wrap.classList.toggle("opacity-50", !isFile);

      if (!isFile) folders.value = 0;
    }

    if (kind && folders) {
      kind.addEventListener("change", syncFoldersState);
      syncFoldersState();
    }
  });
</script>
{% endblock %}
